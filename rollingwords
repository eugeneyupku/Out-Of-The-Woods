import pgzrun
import random

#Initialize
WIDTH,HEIGHT = 768,432
TIME = 0
letters = []
for i in range(26):
    letters.append(chr(97+i))
HP_BAR = []
for i in range(21):
    HP_BAR.append('hp_bar\\'+str(i))
idlerset,ground = [],[]
spdx = 5
garbage = []
words = {}
flag = False
##Import images
#Character
for i in range(12):
    idlerset.append('idle\\idler\\idler'+str(i))
#Floor
for i in range(50):
    ground.append(Actor('tileset\\ground'))

##Setup Character
#PLAYER
PLAYER = Actor('idle\idler\idler0')
PLAYER.jumph = 0
PLAYER.frame = 0
PLAYER.state = 'IDLE'
PLAYER.direction = 'RIGHT'
PLAYER.hp = 20
PLAYER.hpBar = Actor(HP_BAR[20])
#BOSS
BOSS = Actor("soul_reaper\\idle")
BOSS.hp = 20
BOSS.hpBar = Actor(HP_BAR[20])

def initializeMap():
    #Player and boss and Hp
    PLAYER.bottomleft = PLAYER.width*3,HEIGHT-ground[0].height
    BOSS.bottomright = WIDTH,HEIGHT
    PLAYER.hpBar.center = (100,320)
    BOSS.hpBar.center = (590,130)
    #Floor
    for i in range(50):
        ground[i].topright = (i+1)*(ground[i].width-5),HEIGHT - ground[i].height + 2

##Character Status change
def PLAYER_idle():
    PLAYER.frame += 0.25
    PLAYER.image = idlerset[int(PLAYER.frame)%12]

def PLAYER_injured():
    global PLAYER
    PLAYER.image="player_injured"
    PLAYER.hp -= 5
    if(PLAYER.hp < 0):
        PLAYER.hp = 0
        PLAYER.image = 'soul_reaper\\injured'
    PLAYER.hpBar.image = HP_BAR[int(PLAYER.hp)]
    clock.schedule_unique(PLAYER_idle,1.0)

def BOSS_idle():
    BOSS.image="soul_reaper\\idle"

def BOSS_injured():
    global BOSS
    BOSS.image="soul_reaper\\injured"
    BOSS.hp -= 0.5
    if(BOSS.hp < 0):
        BOSS.hp = 0
    BOSS.hpBar.image = HP_BAR[int(BOSS.hp)]
    clock.schedule_unique(BOSS_idle,1.0)

##User Interaction
def on_key_down(key):
    global flag
    flag=key.name.lower()

def drawStage3():
    for i in range(4):
        screen.blit(('background\\plx-'+str(i+1)),(0,0))
    for i in ground:
        i.draw()
    PLAYER.draw()
    PLAYER.hpBar.draw()
    BOSS.draw()
    BOSS.hpBar.draw()

def draw():
    screen.clear()
    drawStage3()
    for i in words:
        tmp = words[i]
        tmp.draw()

def update():
    global flag,key_pressed,TIME,count1
    TIME += 1
    if BOSS.hp >= 10:
        spdx = 20 / BOSS.hp * 5
    else:
        spdx = 12
    if TIME % 30 == 0:
        x=random.choice(letters)
        y=str.upper(x)
        t=Actor('alphabets\\'+x)
        words[x]=t
    for i in words:
        v=words[i]
        v.left += spdx
        if v.left>=WIDTH:
           garbage.append(i)
           PLAYER_injured()

    if flag in words:
        del words[flag]
        BOSS_injured()
        flag = False
    else:
        if flag:
            PLAYER_injured()
            flag= False

initializeMap()
sounds.music.play(loops=10)
sounds.music.set_volume(0.2)
pgzrun.go()
